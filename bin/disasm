#!/usr/bin/env ruby

require "rubygems"
require "bundler/setup"

$: << File.join(File.dirname(__FILE__), '..', 'lib')

require "trollop"
require "avm2"
require "benchmark"

opts = Trollop::options do
  version "furnace-avm2 #{AVM2::VERSION}"
  banner <<-EOS
  furnace-avm2 is something.

  Usage: #{__FILE__} [options]
EOS

  opt :input, "Input file", :type => :string
end

Trollop::die "Input file is required" unless opts[:input]

abc = nil

Benchmark.bm(7) do |stat|
  10.times do
    stat.report "read " do
      File.open(opts[:input]) do |file|
        abc = AVM2::ABC::File.new
        abc.read(file)
      end
    end

    stat.report "write" do
      File.open("out.abc", "w") do |file|
        abc.write(file)
      end
    end
  end
end